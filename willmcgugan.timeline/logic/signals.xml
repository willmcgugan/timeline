<?xml version="1.0" encoding="UTF-8"?>
<moya xmlns="http://moyaproject.com"
    xmlns:let="http://moyaproject.com/let"
    xmlns:db="http://moyaproject.com/db">

    <!-- define signals here -->
    <!--
    <handle signal="moya.auth.post-login">
        <echo>${signal.data.user} just logged in</echo>
    </handle>
    -->

    <handle signal="moya.comments.new-comment">
    	<let event_uuid="(partition:[signal.data.commentobject.object, '-'])[-1]"/>
    	<db:query model="#Event" let:uuid="event_uuid" dst="event"/>
    	<db:update src="event" let:numcomments="signal.data.commentobject.count"/>
    </handle>

</moya>
