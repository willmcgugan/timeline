<?xml version="1.0" encoding="UTF-8"?>
<moya xmlns="http://moyaproject.com"
      xmlns:let="http://moyaproject.com/let"
      xmlns:db="http://moyaproject.com/db"
      xmlns:forms="http://moyaproject.com/forms"
      xmlns:html="http://moyaproject.com/html"
      xmlns:w="http://moyaproject.com/widgets"
      xmlns:comments="http://moyaproject.com/comments"
      xmlns:tl="http://willmcgugan.com/timeline"
      xmlns:tables="http://moyaproject.com/tables">

    <content libname="content.base" template="base.html" final="yes">
        <!--
        <include-js path="js/jquery.js" from="moya.twitter.bootstrap"/>
        <include-js path="js/bootstrap.min.js" from="moya.twitter.bootstrap"/>
    -->
        <include-js path="js/jsonrpc.js" from="moya.jsonrpc"/>
        <include-js path="js/timeline.js"/>
        <include-js path="highlight/highlight.pack.js"/>


        <!--
        <include-css path="css/bootstrap.min.css" from="moya.twitter.bootstrap"/>
        <include-css path="css/timeline.css"/>
        <include-css path="highlight/styles/github.css"/>
    -->
    </content>

    <content libname="content.stream.new_event">
    	<section name="body">
            <html:pre if="result">${prettyjson:result}</html:pre>
    		<w:info>
    			<markdown>
This form can be used to create events.

It's designed to be used by automated systems. You should probably use the official API.

Add `?format=json` to the URL to return a JSON response
    			</markdown>
    		</w:info>
    		<render src="form"/>
    		<w:success if="event">
    			Added ${event}
    		</w:success>
    	</section>
    </content>

    <content libname="content.stream.base" extends="#content.base" template="stream_base.html">
        <section name="side">
        </section>
        <section name="main">
        </section>
    </content>

    <content libname="content.stream" extends="#content.stream.base">
        <str dst="stream_title">${stream.title}</str>
        <section name="side" >
            <node template="stream/info/stream.html" let:stream="stream" let:subscription="subscription"/>
        </section>
        <section name="main">

            <tl:modal id="code_modal" title="Get the Code">
                <markdown>

Use any of the following methods to post events to your stream...

##### Inthing App

```bash
pip install inthing
export INTHING_STREAM=${stream.uuid}
export INTHING_STREAM_PASSWORD=${stream.password}
inthing event --title "New Event" --text "Hello, *World*\!"
```

##### Python

```python
import inthing
stream = inthing.Stream(id="${stream.uuid}", password="${stream.password}")
stream.text_event(title="New Event", text="Hello, *World*!")
```

##### CURL

```
curl 
```
                </markdown>
            </tl:modal>

            <tl:stream events="events" source="stream-${stream.id}" stream_id="stream.uuid" link_to_stream="no" />
        </section>
    </content>

    <content libname="content.user.subscriptions" extends="#content.stream.base">
        <let-str menu="subscriptions"/>
        <section name="side" merge="prepend">
            <node template="stream/info/subscriptions.html" withscope="yes" />
        </section>
        <section name="main">
            <node template="copy/no_subscriptions.html" withscope="yes" if="not timeline.streams"/>
            <tl:stream events="events" source="subs-${user.id}"/>
        </section>
    </content>

    <content libname="content.user.streams" extends="#content.stream.base">
        <let-str menu="user_streams"/>
        <section name="side" merge="prepend">
            <node template="stream/info/user_streams.html" withscope="yes"/>
        </section>
        <section name="main">
            <tl:stream events="events" source="user-${user.id}"/>
        </section>
    </content>

    <content libname="content.event" extends="#content.base" template="view_event.html">
        <let-str menu="event"/>
        <section name="event">
            <node template="event.html" let:event="event" let:link_to_stream="yes"/>
        </section>
        <section name="comments">
            <comments:comments
                markup="markdown"
                namespace="app-${.app.name}"
                topic="event-${event.uuid}"
                url="${.urls.timeline.event(event_id=event.uuid)}"/>
        </section>
    </content>

    <content libname="content.dash" extends="#content.base" template="dash_base.html">
        <let menu="dash"/>
        <section name="side">
            <node template="fragments/dash_sections.html"/>
        </section>
        <section name="main">
            <html:h3>Dashboard</html:h3>
        </section>
    </content>

    <content libname="content.dash.streams" extends="#content.dash" >

        <section name="main">

            <table class="table table-striped" xmlns="http://moyaproject.com/tables">
                <columns>
                    <sort-header name="title">Title</sort-header>
                    <sort-header name="slug">Slug</sort-header>
                    <sort-header name="id">ID</sort-header>
                </columns>
                <rows src="streams" dst="stream">
                    <cell><w:link url="${stream.url}">${stream.title}</w:link></cell>
                    <cell>${stream.slug}</cell>
                    <cell>${stream.uuid}</cell>
                </rows>
            </table>
    

        </section>

    </content>

</moya>
